<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="w-full max-w-2xl">
    <!-- Glassmorphism Card -->
    <div class="backdrop-blur-md bg-white/30 border border-white/20 rounded-2xl shadow-2xl overflow-hidden hover:bg-white/40 transition-all duration-300">
      <!-- Header -->
      <div class="bg-gradient-to-r from-blue-600/80 to-indigo-600/80 backdrop-blur-sm px-6 py-8 border-b border-white/20">
        <h1 class="text-3xl font-bold text-white">Send Resume to HRs</h1>
        <p class="text-blue-100 mt-2">Bulk email your resume to multiple HR professionals</p>
      </div>

      <!-- Form Content -->
      <div class="p-6 sm:p-8" data-controller="emails-form">
        <%= form_with url: emails_path, local: true, multipart: true, class: "space-y-6", data: { "emails-form-target": 'form' } do |f| %>

          <div>
            <label for="emails" class="block text-sm font-semibold text-gray-800 mb-2">HR Emails</label>
            <p class="text-xs text-gray-600 mb-3">Enter emails separated by commas or new lines</p>
            <%= text_area_tag :emails, (@emails || nil), rows: 5, class: "w-full px-4 py-3 border border-white/30 rounded-lg bg-white/50 backdrop-blur-sm text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white/70 resize-none transition", placeholder: "hr@company1.com, hr@company2.com" %>
          </div>

          <div>
            <label for="subject" class="block text-sm font-semibold text-gray-800 mb-2">Subject Line</label>
            <%= text_field_tag :subject, (@subject || nil), class: "w-full px-4 py-3 border border-white/30 rounded-lg bg-white/50 backdrop-blur-sm text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white/70 transition", placeholder: "e.g., Senior Rails Developer Application" %>
          </div>

          <div>
            <label for="template_select" class="block text-sm font-semibold text-gray-800 mb-2">Prewritten Templates</label>
            <p class="text-xs text-gray-600 mb-3">Choose a prewritten message to load into the body</p>
            <select id="template_select" data-emails-form-target="templateSelect" class="w-full px-4 py-3 border border-white/30 rounded-lg bg-white/50 backdrop-blur-sm text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white/70 transition">
              <option value="">-- Select a template --</option>
              <% (@templates || []).each do |name, id| %>
                <option value="<%= id %>"><%= name %></option>
              <% end %>
            </select>
          </div>

          <div>
            <label for="body" class="block text-sm font-semibold text-gray-800 mb-2">Email Body</label>
            <p class="text-xs text-gray-600 mb-3">Write your message here</p>
            <%= text_area_tag :body, (@body || nil), data: { "emails-form-target": 'body' }, class: "w-full px-4 py-3 border border-white/30 rounded-lg bg-white/50 backdrop-blur-sm text-gray-800 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white/70 resize-vertical transition", rows: 12, placeholder: "Enter your email message here...", id: "body_content" %>
          </div>

          <% tinymce_key = ENV['TINYMCE_API_KEY'].presence || Rails.application.credentials.dig(:tinymce, :api_key) %>
          <% if tinymce_key.present? %>
            <script src="https://cdn.tiny.cloud/1/<%= tinymce_key %>/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
          <% else %>
            <div class="rounded-md bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
              <p class="text-sm text-yellow-800">TinyMCE API key is not configured. To enable the rich editor set <strong>TINYMCE_API_KEY</strong> (env) or add <code>tinymce: { api_key: 'YOUR_KEY' }</code> to Rails credentials. The plain textarea will be used until configured.</p>
            </div>
          <% end %>

          <!-- Template loader behavior handled by emails-form Stimulus controller -->

          <div>
            <label for="resume" class="block text-sm font-semibold text-gray-800 mb-2">Resume (PDF or DOC)</label>
            <div class="flex items-center justify-center w-full">
              <label for="resume" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-white/40 rounded-lg cursor-pointer bg-white/20 hover:bg-white/30 backdrop-blur-sm transition">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                  <svg class="w-8 h-8 text-white mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                  <p class="text-sm text-white"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                  <p class="text-xs text-white/80">PDF, DOC, DOCX up to 10MB</p>
                </div>
                <%= file_field_tag :resume, class: "sr-only", id: "resume", data: { "emails-form-target": 'resume' }, accept: ".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" %>
              </label>
            </div>
            <div id="resume_filename_display" data-emails-form-target="resumeDisplay" class="mt-2 text-sm text-white/80">
              <% if @resume_filename.present? %>
                Current file: <strong><%= @resume_filename %></strong>
              <% end %>
            </div>
            <div id="resume_error" data-emails-form-target="resumeError" class="mt-2 text-sm text-red-300 hidden"></div>
          </div>
          <!-- Resume upload behavior handled by emails-form Stimulus controller -->

          <div class="pt-4">
            <%= submit_tag "Send Emails", class: "w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-3 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition shadow-lg hover:shadow-xl" %>
          </div>

        <% end %>
      </div>
    </div>
  </div>
</div>
